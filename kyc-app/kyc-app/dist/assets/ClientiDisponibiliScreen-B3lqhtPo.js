import{a as S,j as e,d as c}from"./index-go8NIyy-.js";import{u as w,b as i}from"./react-vendor-BCFq-EBz.js";import{G as _,K as z,H as A,P as E,B as M,t as x,N as C,u as D}from"./firebase-CZFSqwcK.js";function R(){const l=w(),d=S.currentUser,[g,h]=i.useState(null),[f,y]=i.useState([]),[b,p]=i.useState(!0);i.useEffect(()=>{if(!d){l("/");return}(async()=>{const a=await M(x(c,"staffProfiles",d.uid));a.exists()&&h(a.data())})();const r=_(A(c,"threads"),z("lastMessageAt","desc")),u=E(r,a=>{console.log("ðŸ“± Threads snapshot received:",a.size,"documents");const n=a.docs.map(s=>{const o=s.data();if(!o||!o.lastMessageAt)return console.log("âš ï¸ Skipping thread without lastMessageAt:",s.id),null;const m={id:s.id,client_phone:o.clientJid||s.id,unread_count_for_operator:o.unreadCount||0,last_client_message_at:o.lastMessageAt,assigned_operator_code:o.assigned_operator_code||null,status:o.assigned_operator_code?"RESERVED":"AVAILABLE"};return console.log("ðŸ“„ Thread:",s.id,"Status:",m.status),m}).filter(s=>s!==null&&s.status==="AVAILABLE");console.log("âœ… Available conversations:",n.length),y(n),p(!1)},a=>{console.error("âŒ Error listening to threads:",a),p(!1)});return()=>u()},[d,l]);const v=async t=>{if(!g?.code){alert("Cod operator lipsÄƒ");return}try{const r=x(c,"threads",t);await C(r,{assigned_operator_code:g.code,reserved_at:D()}),l("/whatsapp/chat")}catch(r){console.error("Error reserving conversation:",r),alert("Eroare la rezervare")}},j=t=>{if(!t)return"";const r=t.toDate?t.toDate():new Date(t),a=new Date-r,n=Math.floor(a/6e4);if(n<1)return"acum";if(n<60)return`acum ${n} min`;const s=Math.floor(n/60);return s<24?`acum ${s}h`:`acum ${Math.floor(s/24)} zile`};return e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:"#0a0e27",overflow:"hidden"},children:[e.jsx("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"1.5rem 1rem",color:"white",boxShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"2rem"},children:"ðŸ“±"}),e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:"1.5rem",fontWeight:"600"},children:"ClienÈ›i disponibili"}),e.jsx("p",{style:{margin:"0.2rem 0 0 0",fontSize:"0.85rem",opacity:.9},children:"ConversaÈ›ii WhatsApp nerezervatÐµ"})]})]})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",background:"linear-gradient(180deg, #0a0e27 0%, #151b3d 100%)"},children:b?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",color:"white"},children:[e.jsx("div",{className:"spinner",style:{marginBottom:"1rem"}}),e.jsx("p",{style:{fontSize:"0.95rem",opacity:.8},children:"Se Ã®ncarcÄƒ conversaÈ›ii..."})]}):f.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"3rem 1rem",color:"#888"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"ðŸ’¬"}),e.jsx("p",{style:{fontSize:"1.1rem"},children:"Nu existÄƒ conversaÈ›ii disponibile momentan"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:f.map(t=>e.jsxs("div",{style:{background:"#151b3d",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"16px",padding:"1.25rem",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",transition:"transform 0.2s, box-shadow 0.2s"},onMouseEnter:r=>{r.currentTarget.style.transform="translateY(-2px)",r.currentTarget.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.3)"},onMouseLeave:r=>{r.currentTarget.style.transform="translateY(0)",r.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",boxShadow:"0 2px 8px rgba(102, 126, 234, 0.4)"},children:"ðŸ“±"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"600",color:"white",marginBottom:"0.2rem"},children:t.client_phone}),e.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem",color:"#888",flexWrap:"wrap"},children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.2rem 0.6rem",background:"rgba(76, 175, 80, 0.2)",borderRadius:"12px",color:"#4CAF50",fontWeight:"600"},children:["ðŸ”µ ",t.unread_count_for_operator||0," mesaje"]}),t.last_client_message_at&&e.jsxs("span",{style:{opacity:.7},children:["ðŸ• ",j(t.last_client_message_at)]})]})]})]})}),e.jsxs("button",{onClick:()=>v(t.id),style:{width:"100%",padding:"0.9rem",background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",border:"none",borderRadius:"12px",cursor:"pointer",fontWeight:"600",fontSize:"1rem",boxShadow:"0 4px 12px rgba(79, 172, 254, 0.3)",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},onMouseEnter:r=>{r.currentTarget.style.transform="scale(1.02)",r.currentTarget.style.boxShadow="0 6px 16px rgba(79, 172, 254, 0.5)"},onMouseLeave:r=>{r.currentTarget.style.transform="scale(1)",r.currentTarget.style.boxShadow="0 4px 12px rgba(79, 172, 254, 0.3)"},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:"âœ‹"}),"Preia conversaÈ›ia"]})]},t.id))})})]})}export{R as default};

import{j as e,a as w}from"./index-hvcNTqKU.js";import{b as s,u as C}from"./react-vendor-BCVUYfxV.js";import{l as S}from"./index-CG1tBJBN.js";import"./firebase-CZFSqwcK.js";const v="https://us-central1-superparty-frontend.cloudfunctions.net/whatsapp";function A(){const[a,g]=s.useState([]),[r,p]=s.useState(!0),[u,l]=s.useState(!1),[o,i]=s.useState(""),[d,m]=s.useState("");s.useEffect(()=>{h();const t=setInterval(()=>{h()},3e3);return()=>clearInterval(t)},[]);const h=async()=>{try{const n=await(await fetch(`${v}/api/whatsapp/accounts`)).json();console.log("üì± WhatsApp accounts loaded:",n.accounts),n.success&&(g(n.accounts),n.accounts.forEach(c=>{console.log(`Account ${c.name}: status=${c.status}, hasQR=${!!c.qrCode}`)}))}catch(t){console.error("‚ùå Error loading accounts:",t)}finally{p(!1)}},x=async()=>{if(!o.trim()){alert("Introdu un nume pentru cont!");return}try{console.log("üîÑ Adding account:",o,"phone:",d);const t=await fetch(`${v}/api/whatsapp/add-account`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,phone:d||void 0})});if(console.log("üì° Response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();if(console.log("üì¶ Response data:",n),n.success)l(!1),i(""),m(""),h(),alert("‚úÖ Cont adƒÉugat! A»ôteaptƒÉ QR code"+(d?" »ôi pairing code":"")+"...");else throw new Error(n.error||"Eroare necunoscutƒÉ")}catch(t){console.error("‚ùå Error adding account:",t),alert("‚ùå Eroare la adƒÉugarea contului: "+t.message)}},f=t=>{switch(t){case"connected":return"#10b981";case"qr_ready":return"#f59e0b";case"connecting":return"#3b82f6";default:return"#6b7280"}},b=t=>{switch(t){case"connected":return"‚úÖ Conectat";case"qr_ready":return"üì± ScaneazƒÉ QR";case"connecting":return"üîÑ Se conecteazƒÉ...";default:return"‚è∏Ô∏è Deconectat"}};return r?e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#9ca3af"},children:"Se √ÆncarcƒÉ..."}):e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("h2",{style:{margin:0,color:"white"},children:["üì± Conturi WhatsApp (",a.length,")"]}),e.jsx("button",{onClick:()=>l(!0),style:{padding:"0.75rem 1.5rem",background:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600"},children:"+ AdaugƒÉ Cont"})]}),a.length===0?e.jsxs("div",{style:{padding:"3rem",textAlign:"center",background:"#1f2937",borderRadius:"8px",color:"#9ca3af"},children:[e.jsx("p",{style:{fontSize:"1.125rem",marginBottom:"0.5rem"},children:"üì≠ Niciun cont WhatsApp"}),e.jsx("p",{children:"AdaugƒÉ primul cont pentru a √Æncepe!"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(350px, 1fr))",gap:"1.5rem"},children:a.map(t=>e.jsxs("div",{style:{background:"#1f2937",borderRadius:"8px",padding:"1.5rem",border:"1px solid #374151"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"1rem"},children:e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 0.5rem 0",color:"white"},children:t.name}),e.jsx("div",{style:{display:"inline-block",padding:"0.25rem 0.75rem",background:f(t.status)+"20",color:f(t.status),borderRadius:"4px",fontSize:"0.875rem",fontWeight:"600"},children:b(t.status)})]})}),t.phone&&e.jsxs("p",{style:{margin:"0.5rem 0",color:"#9ca3af",fontSize:"0.875rem"},children:["üìû ",t.phone]}),t.qrCode&&(t.status==="qr_ready"||t.status==="reconnecting"||t.status==="logged_out")&&e.jsxs("div",{style:{marginTop:"1rem",textAlign:"center"},children:[e.jsx("p",{style:{color:"#f59e0b",fontSize:"0.875rem",marginBottom:"0.5rem",fontWeight:"600"},children:"üì± ScaneazƒÉ cu WhatsApp:"}),e.jsx("img",{src:t.qrCode,alt:"QR Code",style:{width:"250px",height:"250px",margin:"0 auto",border:"2px solid #374151",borderRadius:"8px",padding:"0.5rem",background:"white"}}),e.jsx("p",{style:{color:"#6b7280",fontSize:"0.75rem",marginTop:"0.5rem"},children:"WhatsApp ‚Üí Settings ‚Üí Linked Devices ‚Üí Link a Device"}),t.pairingCode&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"#1e293b",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsx("p",{style:{color:"#94a3b8",fontSize:"0.75rem",marginBottom:"0.5rem"},children:"SAU folose»ôte codul de conectare:"}),e.jsx("p",{style:{color:"#10b981",fontSize:"1.5rem",fontWeight:"700",letterSpacing:"0.2em",margin:"0.5rem 0",fontFamily:"monospace"},children:t.pairingCode}),e.jsx("p",{style:{color:"#6b7280",fontSize:"0.7rem",marginTop:"0.5rem"},children:"WhatsApp ‚Üí Settings ‚Üí Linked Devices ‚Üí Link with phone number"})]})]}),t.status==="connected"&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",background:"#10b98120",borderRadius:"6px",textAlign:"center"},children:e.jsx("p",{style:{color:"#10b981",margin:0,fontWeight:"600"},children:"‚úÖ Cont activ »ôi func»õional!"})})]},t.id))}),u&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"#1f2937",borderRadius:"8px",padding:"2rem",maxWidth:"400px",width:"90%"},children:[e.jsx("h3",{style:{margin:"0 0 1.5rem 0",color:"white"},children:"AdaugƒÉ Cont WhatsApp"}),e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"#9ca3af",fontSize:"0.875rem"},children:"Nume cont:"}),e.jsx("input",{type:"text",value:o,onChange:t=>i(t.target.value),placeholder:"Ex: SuperParty Account 1",style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"white",marginBottom:"1rem"}}),e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"#9ca3af",fontSize:"0.875rem"},children:"NumƒÉr telefon (op»õional, pentru pairing code):"}),e.jsx("input",{type:"tel",value:d,onChange:t=>m(t.target.value),placeholder:"Ex: +40712345678",style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"white",marginBottom:"0.5rem"},onKeyPress:t=>t.key==="Enter"&&x()}),e.jsx("p",{style:{color:"#6b7280",fontSize:"0.7rem",marginBottom:"1.5rem",marginTop:"0.25rem"},children:"üí° DacƒÉ introduci numƒÉrul, vei primi »ôi un cod de 8 cifre"}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{onClick:()=>{l(!1),i(""),m("")},style:{flex:1,padding:"0.75rem",background:"#374151",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"AnuleazƒÉ"}),e.jsx("button",{onClick:x,style:{flex:1,padding:"0.75rem",background:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600"},children:"AdaugƒÉ"})]})]})})]})}const y="https://us-central1-superparty-frontend.cloudfunctions.net/whatsapp",k=[{id:"1",name:"Ion Popescu",phone:"+40721234567",unreadCount:2},{id:"2",name:"Maria Ionescu",phone:"+40722345678",unreadCount:0},{id:"3",name:"Andrei Georgescu",phone:"+40723456789",unreadCount:1}],j=!1;function z(){const[a,g]=s.useState([]),[r,p]=s.useState(null),[u,l]=s.useState([]),[o,i]=s.useState(""),[d,m]=s.useState(!0);s.useEffect(()=>{h();const t=S(y);return t.on("connect",()=>{console.log("‚úÖ Connected to backend")}),t.on("whatsapp:message",n=>{console.log("üí¨ New message received:",n),r&&n.message.from===r.id&&l(c=>[...c,{id:n.message.id,text:n.message.body,fromClient:!n.message.fromMe,timestamp:n.message.timestamp*1e3}]),h()}),()=>t.disconnect()},[r]);const h=async()=>{try{if(!j){const n=await(await fetch(`${y}/api/clients`)).json();n.success&&g(n.clients)}}catch(t){console.error("Failed to load clients:",t),g(k)}finally{m(!1)}},x=async t=>{try{if(!j){const c=await(await fetch(`${y}/api/clients/${t}/messages`)).json();c.success&&l(c.messages)}}catch(n){console.error("Failed to load messages:",n)}},f=async()=>{if(!(!o.trim()||!r))try{if(!j){const n=await(await fetch(`${y}/api/clients/${r.id}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o})})).json();n.success&&(l(c=>[...c,n.message]),i(""))}}catch(t){console.error("Failed to send message:",t),alert("‚ùå Eroare la trimiterea mesajului")}},b=t=>{p(t),x(t.id)};return d?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"400px",color:"#9ca3af"},children:e.jsx("div",{children:"Se √ÆncarcƒÉ..."})}):e.jsxs("div",{style:{display:"flex",gap:"1rem",height:"600px",background:"#1f2937",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("div",{style:{width:"300px",borderRight:"1px solid #374151",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #374151",fontWeight:"600",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:["üí¨ Clien»õi (",a.length,")"]}),e.jsx("button",{onClick:()=>{m(!0),h()},style:{background:"#3b82f6",color:"white",border:"none",borderRadius:"4px",padding:"0.5rem",cursor:"pointer",fontSize:"1rem"},title:"Re√ÆmprospƒÉteazƒÉ lista",children:"üîÑ"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto"},children:a.length===0?e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#9ca3af"},children:e.jsx("p",{children:"Niciun client disponibil"})}):a.map(t=>e.jsxs("div",{onClick:()=>b(t),style:{padding:"1rem",background:r?.id===t.id?"#3b82f6":"transparent",borderBottom:"1px solid #374151",cursor:"pointer",transition:"background 0.2s"},onMouseEnter:n=>{r?.id!==t.id&&(n.currentTarget.style.background="#374151")},onMouseLeave:n=>{r?.id!==t.id&&(n.currentTarget.style.background="transparent")},children:[e.jsx("div",{style:{fontWeight:"600",color:"white",marginBottom:"0.25rem"},children:t.name}),e.jsx("div",{style:{fontSize:"0.875rem",color:r?.id===t.id?"#e0e7ff":"#9ca3af"},children:t.phone}),t.unreadCount>0&&e.jsxs("div",{style:{marginTop:"0.5rem",display:"inline-block",background:"#ef4444",color:"white",padding:"0.125rem 0.5rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600"},children:[t.unreadCount," nou",t.unreadCount>1?"e":""]})]},t.id))})]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #374151",background:"#374151"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"white"},children:r.name}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:r.phone})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:u.length===0?e.jsx("div",{style:{textAlign:"center",color:"#9ca3af",padding:"2rem"},children:"Niciun mesaj √ÆncƒÉ"}):u.map((t,n)=>e.jsxs("div",{style:{alignSelf:t.fromClient?"flex-start":"flex-end",maxWidth:"70%"},children:[e.jsx("div",{style:{padding:"0.75rem",borderRadius:"8px",background:t.fromClient?"#374151":"#3b82f6",color:"white"},children:t.text}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem",textAlign:t.fromClient?"left":"right"},children:new Date(t.timestamp).toLocaleTimeString("ro-RO",{hour:"2-digit",minute:"2-digit"})})]},n))}),e.jsxs("div",{style:{padding:"1rem",borderTop:"1px solid #374151",display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:o,onChange:t=>i(t.target.value),onKeyPress:t=>t.key==="Enter"&&f(),placeholder:"Scrie un mesaj...",style:{flex:1,padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"8px",color:"white",fontSize:"1rem"}}),e.jsx("button",{onClick:f,disabled:!o.trim(),style:{padding:"0.75rem 1.5rem",background:o.trim()?"#3b82f6":"#4b5563",color:"white",border:"none",borderRadius:"8px",cursor:o.trim()?"pointer":"not-allowed",fontSize:"1rem",fontWeight:"600"},children:"Trimite"})]})]}):e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af",flexDirection:"column",gap:"1rem"},children:[e.jsx("div",{style:{fontSize:"4rem"},children:"üí¨"}),e.jsx("p",{style:{fontSize:"1.25rem"},children:"SelecteazƒÉ un client"}),e.jsx("p",{style:{fontSize:"0.875rem"},children:"pentru a vedea conversa»õia"})]})})]})}function N(){const a=C(),r=w.currentUser?.email==="ursache.andrei1995@gmail.com",[p,u]=s.useState("accounts"),[l,o]=s.useState(null);return s.useEffect(()=>{if(!r){alert("‚õî Acces interzis! Doar administratorul poate accesa aceastƒÉ paginƒÉ."),a("/home");return}fetch("https://us-central1-superparty-frontend.cloudfunctions.net/whatsapp/api/whatsapp/accounts").then(i=>i.json()).then(i=>{const d=i.accounts?.find(m=>m.status==="connected");d&&(o(d),u("chat"))}).catch(i=>console.error("Error:",i))},[r,a]),r?e.jsxs("div",{className:"page-container",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[e.jsxs("div",{children:[e.jsx("h1",{children:"üí¨ Chat Clienti - WhatsApp"}),e.jsx("p",{className:"page-subtitle",children:p==="chat"?"Conversa»õii cu clien»õii":"Gestionare conturi WhatsApp"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u("chat"),className:p==="chat"?"btn-primary":"btn-secondary",style:{fontSize:"0.875rem",padding:"0.5rem 1rem"},children:"üí¨ Chat"}),e.jsx("button",{onClick:()=>u("accounts"),className:p==="accounts"?"btn-primary":"btn-secondary",style:{fontSize:"0.875rem",padding:"0.5rem 1rem"},children:"‚öôÔ∏è Accounts"})]}),e.jsx("button",{onClick:()=>a("/home"),className:"btn-secondary",children:"‚Üê √énapoi"})]})]})}),p==="accounts"?e.jsx(A,{}):e.jsx(z,{})]}):null}export{N as default};

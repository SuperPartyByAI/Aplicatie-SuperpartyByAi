import{a as b,j as e,d}from"./index-CvBWZv1w.js";import{u as y,b as o}from"./react-vendor-BCFq-EBz.js";import{G as A,H as C,P as D,B as E,t as m,N as S,u as w}from"./firebase-CZFSqwcK.js";function z(){const l=y(),c=b.currentUser,[u,h]=o.useState(null),[p,x]=o.useState([]),[g,v]=o.useState(!0);o.useEffect(()=>{if(!c){l("/");return}(async()=>{const a=await E(m(d,"staffProfiles",c.uid));a.exists()&&h(a.data())})();const t=A(C(d,"threads")),f=D(t,a=>{const n=a.docs.map(r=>{const i=r.data();return{id:r.id,client_phone:i.clientJid||r.id,unread_count_for_operator:i.unreadCount||0,last_client_message_at:i.lastMessageAt||i.createdAt,assigned_operator_code:i.assigned_operator_code||null,status:i.assigned_operator_code?"RESERVED":"AVAILABLE"}}).filter(r=>r.status==="AVAILABLE");x(n),v(!1)});return()=>f()},[c,l]);const _=async s=>{if(!u?.code){alert("Cod operator lipsÄƒ");return}try{const t=m(d,"threads",s);await S(t,{assigned_operator_code:u.code,reserved_at:w()}),l("/whatsapp/chat")}catch(t){console.error("Error reserving conversation:",t),alert("Eroare la rezervare")}},j=s=>{if(!s)return"";const t=s.toDate?s.toDate():new Date(s),a=new Date-t,n=Math.floor(a/6e4);if(n<1)return"acum";if(n<60)return`acum ${n} min`;const r=Math.floor(n/60);return r<24?`acum ${r}h`:`acum ${Math.floor(r/24)} zile`};return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"ðŸ“± ClienÈ›i disponibili"}),e.jsx("p",{className:"page-subtitle",children:"ConversaÈ›ii WhatsApp nerezervatÐµ"})]}),e.jsx("div",{className:"page-content",children:g?e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Se Ã®ncarcÄƒ conversaÈ›ii..."})]}):p.length===0?e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:e.jsx("p",{children:"Nu existÄƒ conversaÈ›ii disponibile momentan"})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:p.map(s=>e.jsxs("div",{style:{background:"var(--card-bg)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ“±"}),e.jsx("strong",{children:s.client_phone})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.9rem",color:"#888"},children:[e.jsxs("span",{children:["ðŸ”µ ",s.unread_count_for_operator||0," mesaje"]}),s.last_client_message_at&&e.jsxs("span",{children:["Ultimul mesaj: ",j(s.last_client_message_at)]})]})]}),e.jsx("button",{onClick:()=>_(s.id),style:{padding:"0.5rem 1rem",background:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Preia / RezervÄƒ"})]},s.id))})})]})}export{z as default};

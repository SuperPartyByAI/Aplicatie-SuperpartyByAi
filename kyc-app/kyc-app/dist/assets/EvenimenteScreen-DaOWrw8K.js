import{a as H,d as m,j as e}from"./index-BdPRXwj2.js";import{u as M,b as i}from"./react-vendor-BCVUYfxV.js";import{P as J,H as h,D as x,G as D,I as P}from"./firebase-CZFSqwcK.js";function Y(){const B=M(),L=H.currentUser,[I,b]=i.useState([]),[R,W]=i.useState({}),[A,E]=i.useState(!0),[g,$]=i.useState(""),[j,O]=i.useState(""),[C,F]=i.useState(""),[S,T]=i.useState(""),[v,U]=i.useState(""),[o,V]=i.useState(""),[c,k]=i.useState(""),[d,f]=i.useState(""),[u,p]=i.useState("");i.useEffect(()=>{z();const t=J(h(m,"evenimente"),a=>{const r=a.docs.map(s=>({id:s.id,...s.data()}));r.sort((s,n)=>{const l=s.data||s.dataStart||"",y=n.data||n.dataStart||"";return l.localeCompare(y)}),b(r)});return()=>t()},[L]);const w=t=>{const a=t.trim().toUpperCase(),r=/^[A-Z]TRAINER$/,s=/^[A-Z]([1-9]|[1-4][0-9]|50)$/;return r.test(a)||s.test(a)},Z=async t=>{if(V(t),!t.trim()){f("");return}if(!w(t)){f("âœ— Format invalid (ex: Atrainer, A1-A50)");return}try{(await x(D(h(m,"staffProfiles"),P("code","==",t.trim())))).empty?f("âœ— Cod nu existÄƒ Ã®n sistem"):f("âœ“ Cod acceptat")}catch(a){console.error("Error validating code:",a),f("âœ— Eroare validare")}},q=async t=>{if(k(t),!t.trim()){p("");return}if(!w(t)){p("âœ— Format invalid (ex: Btrainer, B1-B50)");return}try{(await x(D(h(m,"staffProfiles"),P("code","==",t.trim())))).empty?p("âœ— Cod nu existÄƒ Ã®n sistem"):p("âœ“ Cod acceptat")}catch(a){console.error("Error validating code:",a),p("âœ— Eroare validare")}},z=async()=>{E(!0);try{const[t,a]=await Promise.all([x(h(m,"evenimente")),x(h(m,"staffProfiles"))]),r=t.docs.map(n=>({id:n.id,...n.data()}));r.sort((n,l)=>{const y=n.data||n.dataStart||"",G=l.data||l.dataStart||"";return y.localeCompare(G)});const s={};a.docs.forEach(n=>{const l=n.data();s[l.uid]=l}),b(r),W(s)}catch(t){console.error("Error loading data:",t)}finally{E(!1)}},N=I.filter(t=>{if(g&&!t.nume?.toLowerCase().includes(g.toLowerCase()))return!1;const a=t.data||t.dataStart;return!(j&&a<j||C&&a>C||S&&!t.locatie?.toLowerCase().includes(S.toLowerCase())||v&&t.rol!==v||o.trim()&&d==="âœ“ Cod acceptat"&&!(t.staffAlocat||[]).some(n=>{const l=R[n];return l&&l.code===o.trim()})||c.trim()&&u==="âœ“ Cod acceptat"&&t.cineNoteaza!==c.trim())});return e.jsxs("div",{className:"page-container",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Evenimente"}),e.jsxs("p",{className:"page-subtitle",children:[N.length," evenimente",o&&d==="âœ“ Cod acceptat"&&` cu cod ${o}`,c&&u==="âœ“ Cod acceptat"&&` notate de ${c}`]})]}),e.jsx("button",{onClick:()=>B("/home"),className:"btn-secondary",children:"â† ÃŽnapoi"})]})}),e.jsxs("div",{className:"filters-bar",children:[e.jsx("input",{type:"text",placeholder:"CautÄƒ eveniment...",value:g,onChange:t=>$(t.target.value),className:"filter-input"}),e.jsx("input",{type:"date",placeholder:"Data start",value:j,onChange:t=>O(t.target.value),className:"filter-input"}),e.jsx("input",{type:"date",placeholder:"Data end",value:C,onChange:t=>F(t.target.value),className:"filter-input"}),e.jsx("input",{type:"text",placeholder:"LocaÈ›ie...",value:S,onChange:t=>T(t.target.value),className:"filter-input"}),e.jsxs("select",{value:v,onChange:t=>U(t.target.value),className:"filter-input",children:[e.jsx("option",{value:"",children:"Toate rolurile"}),e.jsx("option",{value:"ospatar",children:"OspÄƒtar"}),e.jsx("option",{value:"barman",children:"Barman"}),e.jsx("option",{value:"bucatar",children:"BucÄƒtar"}),e.jsx("option",{value:"manager",children:"Manager"})]}),e.jsx("button",{onClick:z,className:"btn-refresh",children:"ðŸ”„ ReÃ®ncarcÄƒ"})]}),e.jsxs("div",{className:"filters-bar",style:{marginTop:"1rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flex:1},children:[e.jsx("label",{style:{color:"white",fontSize:"0.875rem",fontWeight:"500"},children:"Ce cod ai"}),e.jsx("input",{type:"text",placeholder:"Introdu cod...",value:o,onChange:t=>Z(t.target.value),className:"filter-input"}),d&&e.jsx("span",{style:{fontSize:"0.875rem",color:d.includes("acceptat")?"#10b981":"#ef4444"},children:d})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flex:1},children:[e.jsx("label",{style:{color:"white",fontSize:"0.875rem",fontWeight:"500"},children:"Cine noteazÄƒ"}),e.jsx("input",{type:"text",placeholder:"Introdu cod...",value:c,onChange:t=>q(t.target.value),className:"filter-input"}),u&&e.jsx("span",{style:{fontSize:"0.875rem",color:u.includes("acceptat")?"#10b981":"#ef4444"},children:u})]})]}),A&&e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Se Ã®ncarcÄƒ evenimentele..."})]}),!A&&e.jsx("div",{className:"evenimente-list",children:N.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Nu existÄƒ evenimente cu aceste filtre."})}):N.map(t=>{const a=t.staffAlocat||[],r=t.nrStaffNecesar||0,s=a.length>0,n=a.length>=r;return e.jsxs("div",{className:"eveniment-card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem"},children:[e.jsx("h3",{children:t.nume}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[s?e.jsx("span",{className:`badge ${n?"badge-disponibil":"badge-warning"}`,children:n?"âœ“ Complet":"âš  ParÈ›ial"}):e.jsx("span",{className:"badge badge-indisponibil",children:"âœ— Nealocat"}),t.rol&&e.jsx("span",{className:"badge badge-role",children:t.rol})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Data:"})," ",t.data||t.dataStart]}),e.jsxs("p",{children:[e.jsx("strong",{children:"LocaÈ›ie:"})," ",t.locatie]}),t.durataOre&&e.jsxs("p",{children:[e.jsx("strong",{children:"DuratÄƒ:"})," ",t.durataOre," ore"]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Staff alocat:"})," ",a.length,"/",r]}),t.bugetStaff&&e.jsxs("p",{children:[e.jsx("strong",{children:"Buget staff:"})," ",t.bugetStaff," RON"]})]}),!s&&r>0&&e.jsxs("p",{children:[e.jsx("strong",{children:"Staff necesar:"})," ",r]}),t.cineNoteaza&&e.jsxs("p",{children:[e.jsx("strong",{children:"Cine noteazÄƒ:"})," ",t.cineNoteaza]})]},t.id)})})]})}export{Y as default};

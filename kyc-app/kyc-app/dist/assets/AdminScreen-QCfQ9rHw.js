import{a as _,d as o,j as e}from"./index-D5X7DQDB.js";import{u as F,b as n}from"./react-vendor-BCVUYfxV.js";import{G as x,I as N,H as m,P as O,D as g,K as $,M as q,N as I,t as D,u as R}from"./firebase-CZFSqwcK.js";function Q(){const y=F(),k=_.currentUser,d=k?.email==="ursache.andrei1995@gmail.com",[t,C]=n.useState("kyc"),[w,E]=n.useState([]),[S,L]=n.useState([]),[K,p]=n.useState(!0),[j,b]=n.useState(null),[h,W]=n.useState(""),[u,M]=n.useState(""),[U]=n.useState(50);n.useEffect(()=>{if(!d){alert("â›” Acces interzis! Doar administratorul poate accesa aceastÄƒ paginÄƒ."),y("/home");return}},[d,y,k]),n.useEffect(()=>{if(d)if(t==="kyc"){f();const s=x(m(o,"users"),N("status","==","pendingApproval")),r=O(s,()=>{f()});return()=>r()}else t==="ai"&&A()},[t,d]);const f=async()=>{p(!0);try{const s=x(m(o,"users"),N("status","==","pendingApproval")),r=await g(s),a=[];for(const i of r.docs){const c=i.data(),v=(await g(x(m(o,"kycSubmissions"),N("uid","==",i.id)))).docs[0]?.data();a.push({uid:i.id,...c,kyc:v})}E(a)}catch(s){console.error("Error loading KYC:",s)}finally{p(!1)}},H=async s=>{if(confirm("Aprobi acest KYC?"))try{const r=await T();await I(D(o,"users",s),{status:"approved",code:r,updatedAt:R()}),alert(`KYC aprobat! Cod generat: ${r}`),f()}catch(r){alert("Eroare: "+r.message)}},P=async s=>{const r=prompt("Motiv respingere:");if(r)try{await I(D(o,"users",s),{status:"rejected",rejectionReason:r,updatedAt:R()}),alert("KYC respins!"),f()}catch(a){alert("Eroare: "+a.message)}},A=async()=>{p(!0);try{const s=x(m(o,"aiConversations"),$("timestamp","desc"),q(U)),a=(await g(s)).docs.map(i=>({id:i.id,...i.data(),timestamp:i.data().timestamp?.toDate()}));L(a)}catch(s){console.error("Error loading AI conversations:",s),alert("Eroare la Ã®ncÄƒrcarea conversaÈ›iilor: "+s.message)}finally{p(!1)}},T=async()=>{const s=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],r=await g(m(o,"users")),a=new Set(r.docs.map(c=>c.data().code).filter(Boolean));for(let c=0;c<100;c++){const z=s[Math.floor(Math.random()*s.length)],v=Math.floor(Math.random()*50)+1,B=`${z}${v}`;if(!a.has(B))return B}return`Z${Date.now().toString().slice(-4)}`},Y=S.filter(s=>!(h&&!s.userMessage?.toLowerCase().includes(h.toLowerCase())&&!s.aiResponse?.toLowerCase().includes(h.toLowerCase())||u&&!s.userEmail?.toLowerCase().includes(u.toLowerCase())&&!s.userName?.toLowerCase().includes(u.toLowerCase()))),l={};return Y.forEach(s=>{const r=s.userId||"unknown";l[r]||(l[r]={userId:s.userId,userEmail:s.userEmail,userName:s.userName,conversations:[]}),l[r].conversations.push(s)}),d?e.jsxs("div",{className:"page-container",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Admin Panel"}),e.jsx("p",{className:"page-subtitle",children:"Gestionare KYC È™i ConversaÈ›ii AI"})]}),e.jsx("button",{onClick:()=>y("/home"),className:"btn-secondary",children:"â† ÃŽnapoi"})]})}),e.jsxs("div",{style:{marginBottom:"2rem",display:"flex",gap:"1rem",borderBottom:"2px solid #374151"},children:[e.jsx("button",{onClick:()=>C("kyc"),style:{padding:"1rem 2rem",background:t==="kyc"?"#3b82f6":"transparent",color:"white",border:"none",borderBottom:t==="kyc"?"3px solid #3b82f6":"3px solid transparent",cursor:"pointer",fontSize:"1rem",fontWeight:"600"},children:"ðŸ“‹ Aprobare KYC"}),e.jsx("button",{onClick:()=>C("ai"),style:{padding:"1rem 2rem",background:t==="ai"?"#3b82f6":"transparent",color:"white",border:"none",borderBottom:t==="ai"?"3px solid #3b82f6":"3px solid transparent",cursor:"pointer",fontSize:"1rem",fontWeight:"600"},children:"ðŸ¤– ConversaÈ›ii AI"})]}),K?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Se Ã®ncarcÄƒ..."})]}):t==="kyc"?e.jsx("div",{className:"kyc-list",children:w.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"âœ… Nu existÄƒ cereri KYC Ã®n aÈ™teptare"})}):w.map(s=>e.jsxs("div",{className:"kyc-card",children:[e.jsxs("div",{className:"kyc-header",children:[e.jsx("h3",{children:s.kyc?.fullName||"N/A"}),e.jsx("span",{className:"badge-pending",children:"â³ ÃŽn aÈ™teptare"})]}),e.jsxs("div",{className:"kyc-body",children:[e.jsxs("div",{className:"kyc-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Email:"}),e.jsx("span",{className:"info-value",children:s.email})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Telefon:"}),e.jsx("span",{className:"info-value",children:s.phone||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"CNP:"}),e.jsx("span",{className:"info-value",children:s.kyc?.cnp||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Sex:"}),e.jsx("span",{className:"info-value",children:s.kyc?.gender||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"AdresÄƒ:"}),e.jsx("span",{className:"info-value",children:s.kyc?.address||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"IBAN:"}),e.jsx("span",{className:"info-value",children:s.kyc?.iban||"N/A"})]}),s.kyc?.isMinor&&e.jsx("div",{className:"info-item full-width",children:e.jsx("span",{className:"badge-warning",children:"âš ï¸ Minor - are pÄƒrinte/tutore"})}),s.kyc?.wantsDriver&&e.jsx("div",{className:"info-item full-width",children:e.jsx("span",{className:"badge-info",children:"ðŸš— Vrea rol È™ofer"})})]}),e.jsxs("div",{className:"kyc-documents",children:[e.jsx("h4",{children:"Documente:"}),e.jsxs("div",{className:"documents-grid",children:[s.kyc?.uploads?.idFront&&e.jsx("a",{href:s.kyc.uploads.idFront,target:"_blank",rel:"noopener noreferrer",className:"doc-link",children:"ðŸ“„ CI FaÈ›Äƒ"}),s.kyc?.uploads?.idBack&&e.jsx("a",{href:s.kyc.uploads.idBack,target:"_blank",rel:"noopener noreferrer",className:"doc-link",children:"ðŸ“„ CI Verso"}),s.kyc?.uploads?.selfie&&e.jsx("a",{href:s.kyc.uploads.selfie,target:"_blank",rel:"noopener noreferrer",className:"doc-link",children:"ðŸ“¸ Selfie"})]})]})]}),e.jsxs("div",{className:"kyc-footer",children:[e.jsx("button",{className:"btn-approve",onClick:()=>H(s.uid),children:"âœ“ AprobÄƒ"}),e.jsx("button",{className:"btn-reject",onClick:()=>P(s.uid),children:"âœ• Respinge"}),e.jsx("button",{className:"btn-details",onClick:()=>b(s),children:"ðŸ‘ï¸ Detalii complete"})]})]},s.uid))}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",padding:"1rem",background:"#1f2937",borderRadius:"0.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,color:"#3b82f6"},children:"ðŸ“Š Statistici ConversaÈ›ii"}),e.jsxs("p",{style:{margin:"0.5rem 0 0 0",color:"#9ca3af",fontSize:"0.875rem"},children:["Total conversaÈ›ii: ",e.jsx("strong",{style:{color:"#10b981"},children:S.length})," | Utilizatori unici: ",e.jsx("strong",{style:{color:"#10b981"},children:Object.keys(l).length})]})]}),e.jsx("button",{onClick:A,className:"btn-refresh",style:{padding:"0.5rem 1rem"},children:"ðŸ”„ ReÃ®ncarcÄƒ"})]}),e.jsxs("div",{style:{marginBottom:"2rem",display:"flex",gap:"1rem",flexWrap:"wrap"},children:[e.jsx("input",{type:"text",placeholder:"ðŸ” CautÄƒ Ã®n conversaÈ›ii...",value:h,onChange:s=>W(s.target.value),className:"filter-input",style:{flex:1,minWidth:"250px"}}),e.jsx("input",{type:"text",placeholder:"ðŸ‘¤ FiltreazÄƒ dupÄƒ user...",value:u,onChange:s=>M(s.target.value),className:"filter-input",style:{flex:1,minWidth:"250px"}})]}),Object.keys(l).length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"ðŸ“­ Nu existÄƒ conversaÈ›ii AI Ã®nregistrate"}),e.jsx("p",{style:{marginTop:"1rem",color:"#9ca3af",fontSize:"0.875rem"},children:"ConversaÈ›iile vor apÄƒrea aici dupÄƒ ce utilizatorii vorbesc cu AI-ul."}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#1f2937",borderRadius:"0.5rem",textAlign:"left"},children:[e.jsx("p",{style:{color:"#d1d5db",fontSize:"0.875rem",marginBottom:"0.5rem"},children:e.jsx("strong",{children:"Cum funcÈ›ioneazÄƒ:"})}),e.jsxs("ul",{style:{color:"#9ca3af",fontSize:"0.875rem",lineHeight:"1.75",marginLeft:"1.5rem"},children:[e.jsx("li",{children:"Fiecare conversaÈ›ie cu AI se salveazÄƒ automat"}),e.jsx("li",{children:"CÃ¢nd user-ul È™terge chat-ul, istoricul complet se pÄƒstreazÄƒ"}),e.jsx("li",{children:"ConversaÈ›iile È™terse sunt marcate cu roÈ™u"}),e.jsx("li",{children:"PoÈ›i filtra È™i cÄƒuta Ã®n toate conversaÈ›iile"})]})]})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2rem"},children:Object.values(l).map(s=>e.jsxs("div",{style:{background:"#1f2937",borderRadius:"0.5rem",padding:"1.5rem",border:"1px solid #374151"},children:[e.jsxs("div",{style:{marginBottom:"1rem",paddingBottom:"1rem",borderBottom:"2px solid #374151",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("h3",{style:{margin:0,color:"#3b82f6",fontSize:"1.25rem"},children:["ðŸ‘¤ ",s.userName||"Unknown"]}),e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#9ca3af",fontSize:"0.875rem"},children:s.userEmail})]}),e.jsxs("span",{style:{background:"#374151",padding:"0.5rem 1rem",borderRadius:"0.25rem",fontSize:"0.875rem",color:"#d1d5db"},children:[s.conversations.length," conversaÈ›ii"]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:s.conversations.map(r=>e.jsxs("div",{style:{background:"#111827",borderRadius:"0.5rem",padding:"1rem",border:r.type==="cleared_by_user"?"2px solid #ef4444":"1px solid #374151"},children:[e.jsxs("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[e.jsxs("span",{children:["ðŸ• ",r.timestamp?new Date(r.timestamp).toLocaleString("ro-RO"):r.clearedAt?new Date(r.clearedAt.toDate()).toLocaleString("ro-RO"):"N/A"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.type==="cleared_by_user"&&e.jsx("span",{style:{background:"#991b1b",padding:"0.25rem 0.5rem",borderRadius:"0.25rem",color:"#fecaca",fontSize:"0.75rem",fontWeight:"600"},children:"ðŸ—‘ï¸ È˜ters de user"}),e.jsx("span",{style:{background:"#1f2937",padding:"0.25rem 0.5rem",borderRadius:"0.25rem"},children:r.model||"gpt-4o-mini"})]})]}),r.type==="cleared_by_user"&&r.conversationHistory?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsxs("div",{style:{background:"#7c2d12",padding:"0.5rem",borderRadius:"0.25rem",color:"#fed7aa",fontSize:"0.75rem",fontWeight:"600"},children:["ðŸ“œ Istoric complet conversaÈ›ie (",r.messageCount||r.conversationHistory.length," mesaje)"]}),r.conversationHistory.map((a,i)=>e.jsxs("div",{style:{background:a.role==="user"?"#064e3b":"#1e3a8a",padding:"0.75rem",borderRadius:"0.375rem",borderLeft:`4px solid ${a.role==="user"?"#10b981":"#3b82f6"}`},children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",marginBottom:"0.5rem",color:a.role==="user"?"#10b981":"#3b82f6"},children:a.role==="user"?"ðŸ‘¤ User":"ðŸ¤– AI"}),e.jsx("div",{style:{color:a.role==="user"?"#d1fae5":"#bfdbfe",fontSize:"0.875rem",lineHeight:"1.5",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:a.content})]},i))]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("div",{style:{color:"#10b981",fontSize:"0.875rem",fontWeight:"600",marginBottom:"0.5rem"},children:"ðŸ‘¤ User:"}),e.jsx("div",{style:{background:"#064e3b",padding:"0.75rem",borderRadius:"0.375rem",color:"#d1fae5",fontSize:"0.875rem",lineHeight:"1.5",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:r.userMessage||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"#3b82f6",fontSize:"0.875rem",fontWeight:"600",marginBottom:"0.5rem"},children:"ðŸ¤– AI:"}),e.jsx("div",{style:{background:"#1e3a8a",padding:"0.75rem",borderRadius:"0.375rem",color:"#bfdbfe",fontSize:"0.875rem",lineHeight:"1.5",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:r.aiResponse||"N/A"})]})]})]},r.id))})]},s.userId))})]}),j&&e.jsx("div",{className:"modal-overlay",onClick:()=>b(null),children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Detalii KYC - ",j.kyc?.fullName]}),e.jsx("button",{className:"modal-close",onClick:()=>b(null),children:"âœ•"})]}),e.jsx("div",{className:"modal-body",children:e.jsx("pre",{children:JSON.stringify(j,null,2)})})]})})]}):null}export{Q as default};

import{a as P,d as w,j as e}from"./index-UTJhL2ly.js";import{u as q,b as o}from"./react-vendor-BCVUYfxV.js";import{G as z,H as D,I as k,D as I}from"./firebase-CZFSqwcK.js";function W(){const Y=q(),g=P.currentUser,O=g?.email==="ursache.andrei1995@gmail.com",[E,T]=o.useState(!0),[x,j]=o.useState("luna-curenta"),[h,v]=o.useState(""),[m,S]=o.useState(""),[d,M]=o.useState([]),[A,R]=o.useState(0);o.useEffect(()=>{const a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),i=new Date(a.getFullYear(),a.getMonth()+1,0);v(t.toISOString().split("T")[0]),S(i.toISOString().split("T")[0])},[]);const b=o.useCallback(async()=>{T(!0);try{let a;O?a=z(D(w,"evenimente")):a=z(D(w,"evenimente"),k("staffAlocat","array-contains",g.uid));const n=(await I(a)).docs.map(s=>({id:s.id,...s.data()})).filter(s=>{const r=s.data||s.dataStart;return r>=h&&r<=m}),l=new Set;n.forEach(s=>{(s.staffAlocat||[]).forEach(r=>l.add(r))});const C={};if(l.size>0){const s=Array.from(l),r=10;for(let u=0;u<s.length;u+=r){const c=s.slice(u,u+r);(await I(z(D(w,"staffProfiles"),k("uid","in",c)))).docs.forEach(F=>{C[F.data().uid]=F.data()})}}const f={};for(const s of n){const r=s.staffAlocat||[],u=s.bugetStaff?s.bugetStaff/r.length:0;for(const c of r){if(!f[c]){const N=C[c]||{};f[c]={staffId:c,nume:N.nume||"Necunoscut",email:N.email||"",evenimente:[],totalSalariu:0,totalOre:0}}f[c].evenimente.push({id:s.id,nume:s.nume,data:s.data||s.dataStart,rol:s.rol,tarif:u,ore:s.durataOre||0}),f[c].totalSalariu+=u,f[c].totalOre+=s.durataOre||0}}const y=Object.values(f);y.sort((s,r)=>r.totalSalariu-s.totalSalariu),M(y);const L=y.reduce((s,r)=>s+r.totalSalariu,0);R(L)}catch(a){console.error("Error loading salarizari:",a)}finally{T(!1)}},[h,m,O,g]);o.useEffect(()=>{h&&m&&b()},[h,m,b]);const p=a=>{const t=new Date;let i,n;switch(a){case"luna-curenta":{i=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,0);break}case"luna-trecuta":{i=new Date(t.getFullYear(),t.getMonth()-1,1),n=new Date(t.getFullYear(),t.getMonth(),0);break}case"trimestru":{const l=Math.floor(t.getMonth()/3);i=new Date(t.getFullYear(),l*3,1),n=new Date(t.getFullYear(),l*3+3,0);break}case"an":{i=new Date(t.getFullYear(),0,1),n=new Date(t.getFullYear(),11,31);break}default:return}v(i.toISOString().split("T")[0]),S(n.toISOString().split("T")[0]),j(a)},$=()=>{let a=`Nume,Email,Nr Evenimente,Total Ore,Total Salariu (RON)
`;d.forEach(l=>{a+=`${l.nume},${l.email},${l.evenimente.length},${l.totalOre},${l.totalSalariu.toFixed(2)}
`});const t=new Blob([a],{type:"text/csv"}),i=window.URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=`salarizare_${h}_${m}.csv`,n.click()};return e.jsxs("div",{className:"page-container",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Salarizare"}),e.jsx("p",{className:"page-subtitle",children:"Calcul automat salarii bazat pe evenimente"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{onClick:()=>Y("/home"),className:"btn-secondary",children:"â† ÃŽnapoi"}),d.length>0&&e.jsx("button",{onClick:$,className:"btn-refresh",children:"ðŸ“¥ Export CSV"})]})]})}),e.jsxs("div",{className:"filters-bar",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>p("luna-curenta"),className:x==="luna-curenta"?"btn-refresh":"btn-secondary",children:"Luna CurentÄƒ"}),e.jsx("button",{onClick:()=>p("luna-trecuta"),className:x==="luna-trecuta"?"btn-refresh":"btn-secondary",children:"Luna TrecutÄƒ"}),e.jsx("button",{onClick:()=>p("trimestru"),className:x==="trimestru"?"btn-refresh":"btn-secondary",children:"Trimestru"}),e.jsx("button",{onClick:()=>p("an"),className:x==="an"?"btn-refresh":"btn-secondary",children:"An"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[e.jsx("input",{type:"date",value:h,onChange:a=>{v(a.target.value),j("custom")},className:"filter-input",style:{width:"150px"}}),e.jsx("span",{style:{color:"#9ca3af"},children:"â†’"}),e.jsx("input",{type:"date",value:m,onChange:a=>{S(a.target.value),j("custom")},className:"filter-input",style:{width:"150px"}}),e.jsx("button",{onClick:b,className:"btn-refresh",children:"ðŸ”„ ActualizeazÄƒ"})]})]}),e.jsxs("div",{className:"salarizare-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Staff"}),e.jsx("p",{children:d.length})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Evenimente"}),e.jsx("p",{children:d.reduce((a,t)=>a+t.evenimente.length,0)})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Ore"}),e.jsx("p",{children:d.reduce((a,t)=>a+t.totalOre,0)})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Salariu"}),e.jsxs("p",{children:[A.toFixed(2)," RON"]})]})]}),E&&e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Se calculeazÄƒ salarizÄƒrile..."})]}),!E&&e.jsx("div",{className:"salarizari-list",children:d.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Nu existÄƒ date de salarizare pentru perioada selectatÄƒ."})}):d.map(a=>e.jsxs("div",{className:"salarizare-card",children:[e.jsxs("div",{className:"sal-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:a.nume}),e.jsx("p",{style:{color:"#9ca3af",fontSize:"0.875rem"},children:a.email})]}),e.jsxs("div",{className:"sal-total",children:[e.jsx("span",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:"Total:"}),e.jsxs("span",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#dc2626"},children:[a.totalSalariu.toFixed(2)," RON"]})]})]}),e.jsxs("div",{className:"sal-body",children:[e.jsxs("div",{className:"sal-stats",children:[e.jsxs("span",{className:"badge badge-allocated",children:[a.evenimente.length," evenimente"]}),e.jsxs("span",{className:"badge badge-staff",children:[a.totalOre," ore"]})]}),e.jsxs("details",{style:{marginTop:"1rem"},children:[e.jsx("summary",{style:{cursor:"pointer",color:"#dc2626",fontWeight:"500"},children:"Vezi detalii evenimente"}),e.jsx("div",{style:{marginTop:"1rem"},children:a.evenimente.map(t=>e.jsxs("div",{style:{padding:"0.75rem",background:"#111827",borderRadius:"0.375rem",marginBottom:"0.5rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:t.nume})}),e.jsxs("p",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:[t.data," â€¢ ",t.rol," â€¢ ",t.ore,"h â€¢ ",t.tarif.toFixed(2)," RON"]})]},t.id))})]})]})]},a.staffId))})]})}export{W as default};

#!/bin/bash

# Git Hook: Pre-Commit
# RuleazÄƒ automat Ã®nainte de fiecare commit
# VerificÄƒ cÄƒ codul e valid È™i testele trec

set -e

echo "ğŸ” Pre-Commit Hook: Verificare cod..."

# 1. VerificÄƒ cÄƒ nu existÄƒ console.log Ã®n cod (doar warning)
echo "ğŸ“ Verificare console.log..."
if git diff --cached --name-only | grep -E '\.(js|jsx|ts|tsx)$' | xargs grep -n "console\.log" 2>/dev/null; then
  echo "âš ï¸  WARNING: Ai console.log Ã®n cod. ConsiderÄƒ sÄƒ le È™tergi."
  echo "   (Nu blocheazÄƒ commit-ul, doar te avertizeazÄƒ)"
fi

# 2. VerificÄƒ cÄƒ nu existÄƒ debugger statements
echo "ğŸ› Verificare debugger..."
if git diff --cached --name-only | grep -E '\.(js|jsx|ts|tsx)$' | xargs grep -n "debugger" 2>/dev/null; then
  echo "âŒ ERROR: Ai 'debugger' statements Ã®n cod!"
  echo "   È˜terge-le Ã®nainte de commit."
  exit 1
fi

# 3. VerificÄƒ cÄƒ nu existÄƒ TODO-uri critice
echo "ğŸ“‹ Verificare TODO-uri critice..."
if git diff --cached --name-only | grep -E '\.(js|jsx|ts|tsx)$' | xargs grep -n "TODO.*CRITICAL\|FIXME.*URGENT" 2>/dev/null; then
  echo "âŒ ERROR: Ai TODO-uri CRITICAL/URGENT nerezolvate!"
  echo "   RezolvÄƒ-le Ã®nainte de commit."
  exit 1
fi

# 4. VerificÄƒ cÄƒ nu existÄƒ API keys hardcodate
echo "ğŸ”‘ Verificare API keys..."
if git diff --cached --name-only | grep -E '\.(js|jsx|ts|tsx)$' | xargs grep -nE "api[_-]?key.*=.*['\"][a-zA-Z0-9]{20,}['\"]|secret.*=.*['\"][a-zA-Z0-9]{20,}['\"]" 2>/dev/null; then
  echo "âŒ ERROR: Posibil API key hardcodat detectat!"
  echo "   MutÄƒ-l Ã®n .env sau Firebase config."
  exit 1
fi

# 5. VerificÄƒ formatare fiÈ™iere (basic)
echo "ğŸ“ Verificare formatare..."
if git diff --cached --name-only | grep -E '\.(js|jsx|ts|tsx)$' | xargs grep -l $'\t' 2>/dev/null; then
  echo "âš ï¸  WARNING: Unele fiÈ™iere folosesc tab-uri Ã®n loc de spaÈ›ii."
  echo "   (Nu blocheazÄƒ commit-ul)"
fi

echo "âœ… Pre-Commit verificÄƒri complete!"
echo ""
